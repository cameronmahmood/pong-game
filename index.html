<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pong (HTML5 Canvas)</title>
  <style>
    :root {
      --bg:#0b0b10; --fg:#ffffff; --muted:#b9b9c8; --accent:#f5d90a;
    }
    html, body { height: 100%; margin: 0; background: var(--bg); color: var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif; }
    .wrap { max-width: 960px; margin: 0 auto; padding: 16px; }
    h1 { font-weight: 700; font-size: clamp(18px, 3vw, 24px); margin: 8px 0 12px; letter-spacing: 0.5px; }
    .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    .btn { cursor: pointer; background: #1f2937; border: 1px solid #2d3748; padding: 10px 14px; border-radius: 12px; color: var(--fg); font-weight: 600; }
    .btn:hover { filter: brightness(1.15); }
    .btn:active { transform: translateY(1px); }
    label { color: var(--muted); user-select: none; }
    canvas { display: block; width: 100%; height: auto; background:#000; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.45); }
    .hint { color: var(--muted); font-size: 14px; margin-top: 8px; }

    /* Mobile touch controls */
    @media (max-width: 800px) {
      .touch { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; }
      .tbtn { padding: 14px; border-radius: 12px; text-align: center; background:#111827; border:1px solid #1f2937; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ðŸŽ® Pong</h1>
    <div class="row">
      <button id="start" class="btn">Start / Reset</button>
      <button id="pause" class="btn">Pause</button>
      <button id="swap" class="btn">1P / 2P</button>
      <label><input type="checkbox" id="sound" /> Sound</label>
    </div>
    <p class="hint">Controls: Left = W/S, Right = â†‘/â†“. On mobile, use the touch buttons.</p>
    <canvas id="game" width="800" height="600" aria-label="Pong game area"></canvas>
    <div class="touch" aria-hidden="true">
      <div class="tbtn" id="lUp">Left â–²</div>
      <div class="tbtn" id="rUp">Right â–²</div>
      <div class="tbtn" id="lDn">Left â–¼</div>
      <div class="tbtn" id="rDn">Right â–¼</div>
    </div>
  </div>

  <script>
    const WIDTH = 800, HEIGHT = 600;
    const PADDLE_W = 12, PADDLE_H = 100, BALL = 14;
    const PADDLE_SPEED = 7, BALL_SPEED = 6, WIN_SCORE = 11;

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    // Audio (tiny blips synthesized with WebAudio)
    let audioCtx; const beeps = {};
    function initAudio(){
      if(audioCtx) return; audioCtx = new (window.AudioContext||window.webkitAudioContext)();
      const make = (freq, dur=0.06)=>()=>{ const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.frequency.value=freq; o.type='square'; g.gain.setValueAtTime(0.12, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+dur); o.connect(g).connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+dur); };
      beeps.wall = make(420); beeps.paddle = make(640); beeps.score = make(220, 0.18);
    }

    const keys = new Set();
    document.addEventListener('keydown', e=>{ keys.add(e.code); });
    document.addEventListener('keyup', e=>{ keys.delete(e.code); });

    // Touch controls
    const press = (code, on)=>{ if(on) keys.add(code); else keys.delete(code); };
    for(const [id, code] of [['lUp','KeyW'],['lDn','KeyS'],['rUp','ArrowUp'],['rDn','ArrowDown']]){
      const el = document.getElementById(id);
      ['pointerdown','pointerup','pointerleave','pointercancel'].forEach(evt=>{
        el.addEventListener(evt, (e)=>{ e.preventDefault(); press(code, evt==='pointerdown'); });
      });
    }

    // Game state
    const state = {
      singlePlayer: true,
      running: false,
      left: { x: 40, y: HEIGHT/2 - PADDLE_H/2 },
      right:{ x: WIDTH-40-PADDLE_W, y: HEIGHT/2 - PADDLE_H/2 },
      ball: { x: WIDTH/2, y: HEIGHT/2, vx: BALL_SPEED, vy: BALL_SPEED },
      scoreL: 0, scoreR: 0
    };

    function resetBall(){
      state.ball.x = WIDTH/2; state.ball.y = HEIGHT/2;
      const dirX = Math.random() < 0.5 ? -1 : 1;
      const dirY = Math.random() < 0.5 ? -1 : 1;
      state.ball.vx = dirX * BALL_SPEED;
      state.ball.vy = dirY * (BALL_SPEED - 2 + Math.random()*3);
    }

    function draw(){
      ctx.clearRect(0,0,WIDTH,HEIGHT);
      // Net
      ctx.fillStyle = '#c8c8c8';
      for(let y=0;y<HEIGHT;y+=30){ ctx.fillRect(WIDTH/2-2, y+10, 4, 10); }
      // Paddles + ball
      ctx.fillStyle = '#fff';
      ctx.fillRect(state.left.x, state.left.y, PADDLE_W, PADDLE_H);
      ctx.fillRect(state.right.x, state.right.y, PADDLE_W, PADDLE_H);
      ctx.beginPath(); ctx.ellipse(state.ball.x, state.ball.y, BALL/2, BALL/2, 0, 0, Math.PI*2); ctx.fill();
      // Score
      ctx.font = 'bold 36px system-ui, sans-serif'; ctx.textAlign='center'; ctx.textBaseline='top'; ctx.fillText(`${state.scoreL}   ${state.scoreR}`, WIDTH/2, 16);
      if(state.scoreL>=WIN_SCORE || state.scoreR>=WIN_SCORE){
        const winner = state.scoreL>state.scoreR ? 'Left' : 'Right';
        ctx.fillStyle = '#f5d90a'; ctx.font = 'bold 28px system-ui, sans-serif';
        ctx.fillText(`${winner} wins! Press Start to reset`, WIDTH/2, HEIGHT/2 - 14);
      }
    }

    function step(){
      if(!state.running){ draw(); return; }
      // Input
      if(keys.has('KeyW') && state.left.y > 0) state.left.y -= PADDLE_SPEED;
      if(keys.has('KeyS') && state.left.y + PADDLE_H < HEIGHT) state.left.y += PADDLE_SPEED;

      if(state.singlePlayer){
        const diff = state.ball.y - (state.right.y + PADDLE_H/2);
        if(Math.abs(diff) > 6) state.right.y += (diff > 0 ? 1 : -1) * PADDLE_SPEED;
      } else {
        if(keys.has('ArrowUp') && state.right.y > 0) state.right.y -= PADDLE_SPEED;
        if(keys.has('ArrowDown') && state.right.y + PADDLE_H < HEIGHT) state.right.y += PADDLE_SPEED;
      }

      // Move ball
      state.ball.x += state.ball.vx; state.ball.y += state.ball.vy;

      // Walls
      if(state.ball.y - BALL/2 <= 0){ state.ball.y = BALL/2; state.ball.vy *= -1; if(sound.checked){ initAudio(); beeps.wall(); } }
      if(state.ball.y + BALL/2 >= HEIGHT){ state.ball.y = HEIGHT - BALL/2; state.ball.vy *= -1; if(sound.checked){ initAudio(); beeps.wall(); } }

      // Paddle collisions with angle
      const hitLeft = state.ball.x - BALL/2 <= state.left.x + PADDLE_W && state.ball.y >= state.left.y && state.ball.y <= state.left.y + PADDLE_H;
      const hitRight= state.ball.x + BALL/2 >= state.right.x && state.ball.y >= state.right.y && state.ball.y <= state.right.y + PADDLE_H;
      if(hitLeft && state.ball.vx < 0){
        const offset = ((state.ball.y - (state.left.y + PADDLE_H/2)) / (PADDLE_H/2));
        state.ball.vx *= -1; state.ball.vy = Math.max(Math.min(state.ball.vy + offset * 3, BALL_SPEED + 3), -BALL_SPEED - 3);
        state.ball.x = state.left.x + PADDLE_W + BALL/2; if(sound.checked){ initAudio(); beeps.paddle(); }
      }
      if(hitRight && state.ball.vx > 0){
        const offset = ((state.ball.y - (state.right.y + PADDLE_H/2)) / (PADDLE_H/2));
        state.ball.vx *= -1; state.ball.vy = Math.max(Math.min(state.ball.vy + offset * 3, BALL_SPEED + 3), -BALL_SPEED - 3);
        state.ball.x = state.right.x - BALL/2; if(sound.checked){ initAudio(); beeps.paddle(); }
      }

      // Scoring
      if(state.ball.x + BALL/2 < 0){ state.scoreR++; resetBall(); if(sound.checked){ initAudio(); beeps.score(); } }
      if(state.ball.x - BALL/2 > WIDTH){ state.scoreL++; resetBall(); if(sound.checked){ initAudio(); beeps.score(); } }

      draw();
    }

    // Controls
    const startBtn = document.getElementById('start');
    const pauseBtn = document.getElementById('pause');
    const swapBtn  = document.getElementById('swap');
    const sound    = document.getElementById('sound');

    startBtn.addEventListener('click', ()=>{ state.scoreL = state.scoreR = 0; state.left.y = HEIGHT/2 - PADDLE_H/2; state.right.y = HEIGHT/2 - PADDLE_H/2; resetBall(); state.running = true; });
    pauseBtn.addEventListener('click', ()=>{ state.running = !state.running; });
    swapBtn.addEventListener('click', ()=>{ state.singlePlayer = !state.singlePlayer; swapBtn.textContent = state.singlePlayer ? '1P / 2P' : '2P / 1P'; });

    // Main loop
    function loop(){ step(); requestAnimationFrame(loop); }
    draw(); requestAnimationFrame(loop);
  </script>
</body>
</html>